{"version":3,"file":"11-cpuUVLo9.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(auth)/login/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/11.js"],"sourcesContent":["import { signInWithEmailAndPassword } from \"firebase/auth\";\nimport { redirect, fail } from \"@sveltejs/kit\";\nimport { f as firebase } from \"../../../../chunks/firebase.js\";\nimport { doc, updateDoc, getDocs, collection } from \"firebase/firestore\";\nconst actions = {\n  login: async ({ fetch, request }) => {\n    const formData = await request.formData();\n    const email = formData.get(\"email\");\n    const password = formData.get(\"password\");\n    if (email === \"admin\" && password === \"admin\") {\n      const admin = { email, password };\n      await fetch(\"/api/session\", {\n        method: \"POST\",\n        credentials: \"same-origin\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(admin)\n      });\n      throw redirect(303, \"/admin\");\n    }\n    try {\n      const userInfo = await signInWithEmailAndPassword(firebase.auth, email, password);\n      const user_session = await fetch(\"/api/session\", {\n        method: \"GET\",\n        credentials: \"same-origin\",\n        headers: { \"Content-Type\": \"application/json\" }\n      });\n      if (user_session.status === 200) {\n        const user = await user_session.json();\n        const docRef = doc(firebase.db, \"Users\", user.DocId);\n        user.lastLogin = (/* @__PURE__ */ new Date()).toDateString();\n        await updateDoc(docRef, {\n          lastLogin: (/* @__PURE__ */ new Date()).toDateString()\n        });\n        await fetch(\"/api/session\", {\n          method: \"POST\",\n          credentials: \"same-origin\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(user)\n        });\n      } else {\n        const Snapshot = (await getDocs(collection(firebase.db, \"Users\"))).docs;\n        if (Snapshot.length === 0) return true;\n        for (const doc2 of Snapshot) {\n          if (doc2.data().id === userInfo.user.uid) {\n            const User = {\n              DocId: doc2.id,\n              id: userInfo.user.uid,\n              FullName: userInfo.user.displayName || \"\",\n              email,\n              createdAt: doc2.data().createdAt,\n              lastLogin: Date.now().toString(),\n              Emails: doc2.data().Emails\n            };\n            await fetch(\"/api/session\", {\n              method: \"POST\",\n              credentials: \"same-origin\",\n              headers: { \"Content-Type\": \"application/json\" },\n              body: JSON.stringify(User)\n            });\n            break;\n          }\n        }\n      }\n    } catch (err) {\n      return fail(400, err instanceof Error ? { error: err.message } : { error: \"Login failed\" });\n    }\n    throw redirect(303, \"/home\");\n  }\n};\nconst load = ({ cookies }) => {\n  cookies.get(\"user_session\");\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(auth)/login/_page.server.ts.js';\n\nexport const index = 11;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(auth)/login/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(auth)/login/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/11.BvKDG1ti.js\",\"_app/immutable/chunks/DsnmJJEf.js\",\"_app/immutable/chunks/7vUO3RyR.js\",\"_app/immutable/chunks/DlUQHRdJ.js\",\"_app/immutable/chunks/Cs_X23zF.js\",\"_app/immutable/chunks/BG9ubxqI.js\",\"_app/immutable/chunks/dSJZ5dLC.js\",\"_app/immutable/chunks/CuFu-7Bj.js\",\"_app/immutable/chunks/CYgJF_JY.js\",\"_app/immutable/chunks/Nr_qU2nG.js\",\"_app/immutable/chunks/Cn7woczV.js\",\"_app/immutable/chunks/Dgsv8Pl-.js\",\"_app/immutable/chunks/CrL3HiYF.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}