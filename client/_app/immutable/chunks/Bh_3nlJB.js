import{aL as h,aM as w,av as x,X as M,aR as S,a8 as E,aS as A,ab as T,aT as D,aU as H,l as g,D as f,aV as F}from"./813Ht5r7.js";import{b as R}from"./KXhGhqBc.js";import{i as U,a as V,b as C,c as N}from"./CgQPfSTX.js";function O(t){var r=x,n=M;h(null),w(null);try{return t()}finally{h(r),w(n)}}function P(t,r,n,s=n){t.addEventListener(r,()=>O(n));const a=t.__on_r;a?t.__on_r=()=>{a(),s(!0)}:t.__on_r=()=>s(!0),R()}function X(t,r,n){S(()=>{var s=E(()=>r(t,n?.())||{});if(n&&s?.update){var a=!1,o={};A(()=>{var e=n();T(e),a&&D(o,e)&&(o=e,s.update(e))}),a=!0}if(s?.destroy)return()=>s.destroy()})}function $(t,r,n=r){var s=H(),a=new WeakSet;P(t,"input",o=>{var e=o?t.defaultValue:t.value;if(e=d(t)?m(e):e,n(e),f!==null&&a.add(f),s&&e!==(e=r())){var i=t.selectionStart,c=t.selectionEnd;t.value=e??"",c!==null&&(t.selectionStart=i,t.selectionEnd=Math.min(c,t.value.length))}}),(g&&t.defaultValue!==t.value||E(r)==null&&t.value)&&(n(d(t)?m(t.value):t.value),f!==null&&a.add(f)),A(()=>{var o=r();if(t===document.activeElement){var e=F??f;if(a.has(e))return}d(t)&&o===m(t.value)||t.type==="date"&&!o&&!t.value||o!==t.value&&(t.value=o??"")})}function d(t){var r=t.type;return r==="number"||r==="range"}function m(t){return t===""?null:+t}function j(t){const r=JSON.parse(t);return r.data&&(r.data=C(r.data,N.decoders)),r}function v(t){return HTMLElement.prototype.cloneNode.call(t)}function B(t,r=()=>{}){const n=async({action:a,result:o,reset:e=!0,invalidateAll:i=!0})=>{o.type==="success"&&(e&&HTMLFormElement.prototype.reset.call(t),i&&await U()),(location.origin+location.pathname===a.origin+a.pathname||o.type==="redirect"||o.type==="error")&&await V(o)};async function s(a){if((a.submitter?.hasAttribute("formmethod")?a.submitter.formMethod:v(t).method)!=="post")return;a.preventDefault();const e=new URL(a.submitter?.hasAttribute("formaction")?a.submitter.formAction:v(t).action),i=a.submitter?.hasAttribute("formenctype")?a.submitter.formEnctype:v(t).enctype,c=new FormData(t),b=a.submitter?.getAttribute("name");b&&c.append(b,a.submitter?.getAttribute("value")??"");const p=new AbortController;let _=!1;const L=await r({action:e,cancel:()=>_=!0,controller:p,formData:c,formElement:t,submitter:a.submitter})??n;if(_)return;let u;try{const l=new Headers({accept:"application/json","x-sveltekit-action":"true"});i!=="multipart/form-data"&&l.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(i)?i:"application/x-www-form-urlencoded");const k=i==="multipart/form-data"?c:new URLSearchParams(c),y=await fetch(e,{method:"POST",headers:l,cache:"no-store",body:k,signal:p.signal});u=j(await y.text()),u.type==="error"&&(u.status=y.status)}catch(l){if(l?.name==="AbortError")return;u={type:"error",error:l}}await L({action:e,formData:c,formElement:t,update:l=>n({action:e,result:u,reset:l?.reset,invalidateAll:l?.invalidateAll}),result:u})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",s)}}}export{X as a,$ as b,B as e};
