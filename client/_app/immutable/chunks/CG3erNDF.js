import{aE as L,aa as w,aF as E,ad as k,aR as S,av as x,D as d,l as M,aS as T}from"./hMZFjhjB.js";import{l as D}from"./C3vF11sT.js";import{i as F,a as H,p as g,b as R}from"./CMM3Q6sT.js";function V(a,r,n){L(()=>{var s=w(()=>r(a,n?.())||{});if(n&&s?.update){var e=!1,o={};E(()=>{var t=n();k(t),e&&S(o,t)&&(o=t,s.update(t))}),e=!0}if(s?.destroy)return()=>s.destroy()})}function j(a,r,n=r){var s=x(),e=new WeakSet;D(a,"input",o=>{var t=o?a.defaultValue:a.value;if(t=f(a)?m(t):t,n(t),d!==null&&e.add(d),s&&t!==(t=r())){var l=a.selectionStart,i=a.selectionEnd;a.value=t??"",i!==null&&(a.selectionStart=l,a.selectionEnd=Math.min(i,a.value.length))}}),(M&&a.defaultValue!==a.value||w(r)==null&&a.value)&&(n(f(a)?m(a.value):a.value),d!==null&&e.add(d)),E(()=>{var o=r();if(a===document.activeElement){var t=T??d;if(e.has(t))return}f(a)&&o===m(a.value)||a.type==="date"&&!o&&!a.value||o!==a.value&&(a.value=o??"")})}function f(a){var r=a.type;return r==="number"||r==="range"}function m(a){return a===""?null:+a}function C(a){const r=JSON.parse(a);return r.data&&(r.data=g(r.data,R.decoders)),r}function b(a){return HTMLElement.prototype.cloneNode.call(a)}function q(a,r=()=>{}){const n=async({action:e,result:o,reset:t=!0,invalidateAll:l=!0})=>{o.type==="success"&&(t&&HTMLFormElement.prototype.reset.call(a),l&&await F()),(location.origin+location.pathname===e.origin+e.pathname||o.type==="redirect"||o.type==="error")&&await H(o)};async function s(e){if((e.submitter?.hasAttribute("formmethod")?e.submitter.formMethod:b(a).method)!=="post")return;e.preventDefault();const t=new URL(e.submitter?.hasAttribute("formaction")?e.submitter.formAction:b(a).action),l=e.submitter?.hasAttribute("formenctype")?e.submitter.formEnctype:b(a).enctype,i=new FormData(a),p=e.submitter?.getAttribute("name");p&&i.append(p,e.submitter?.getAttribute("value")??"");const v=new AbortController;let y=!1;const A=await r({action:t,cancel:()=>y=!0,controller:v,formData:i,formElement:a,submitter:e.submitter})??n;if(y)return;let u;try{const c=new Headers({accept:"application/json","x-sveltekit-action":"true"});l!=="multipart/form-data"&&c.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(l)?l:"application/x-www-form-urlencoded");const _=l==="multipart/form-data"?i:new URLSearchParams(i),h=await fetch(t,{method:"POST",headers:c,cache:"no-store",body:_,signal:v.signal});u=C(await h.text()),u.type==="error"&&(u.status=h.status)}catch(c){if(c?.name==="AbortError")return;u={type:"error",error:c}}await A({action:t,formData:i,formElement:a,update:c=>n({action:t,result:u,reset:c?.reset,invalidateAll:c?.invalidateAll}),result:u})}return HTMLFormElement.prototype.addEventListener.call(a,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(a,"submit",s)}}}export{V as a,j as b,q as e};
