import{aD as E,aE as k,ar as S,a3 as T,v as D,l as b,w as h,o as H,aK as C,aL as F,z as A,M as f,aM as g}from"./nGUMutCJ.js";import{b as z}from"./AhqUU1ts.js";import{i as N,a as O,b as P,c as R}from"./Bgbd2wj0.js";function U(e){var t=S,o=T;E(null),k(null);try{return e()}finally{E(t),k(o)}}function L(e,t,o,c=o){e.addEventListener(t,()=>U(o));const a=e.__on_r;a?e.__on_r=()=>{a(),c(!0)}:e.__on_r=()=>c(!0),z()}function K(e,t,o){D(()=>{var c=b(()=>t(e,o?.())||{});if(o&&c?.update){var a=!1,n={};h(()=>{var r=o();H(r),a&&C(n,r)&&(n=r,c.update(r))}),a=!0}if(c?.destroy)return()=>c.destroy()})}function W(e,t,o=t){var c=F(),a=new WeakSet;L(e,"input",n=>{var r=n?e.defaultValue:e.value;if(r=d(e)?m(r):r,o(r),f!==null&&a.add(f),c&&r!==(r=t())){var s=e.selectionStart,i=e.selectionEnd;e.value=r??"",i!==null&&(e.selectionStart=s,e.selectionEnd=Math.min(i,e.value.length))}}),(A&&e.defaultValue!==e.value||b(t)==null&&e.value)&&(o(d(e)?m(e.value):e.value),f!==null&&a.add(f)),h(()=>{var n=t();if(e===document.activeElement){var r=g??f;if(a.has(r))return}d(e)&&n===m(e.value)||e.type==="date"&&!n&&!e.value||n!==e.value&&(e.value=n??"")})}function $(e,t,o=t){L(e,"change",c=>{var a=c?e.defaultChecked:e.checked;o(a)}),(A&&e.defaultChecked!==e.checked||b(t)==null)&&o(e.checked),h(()=>{var c=t();e.checked=!!c})}function d(e){var t=e.type;return t==="number"||t==="range"}function m(e){return e===""?null:+e}function V(e){const t=JSON.parse(e);return t.data&&(t.data=P(t.data,R.decoders)),t}function v(e){return HTMLElement.prototype.cloneNode.call(e)}function G(e,t=()=>{}){const o=async({action:a,result:n,reset:r=!0,invalidateAll:s=!0})=>{n.type==="success"&&(r&&HTMLFormElement.prototype.reset.call(e),s&&await N()),(location.origin+location.pathname===a.origin+a.pathname||n.type==="redirect"||n.type==="error")&&await O(n)};async function c(a){if((a.submitter?.hasAttribute("formmethod")?a.submitter.formMethod:v(e).method)!=="post")return;a.preventDefault();const r=new URL(a.submitter?.hasAttribute("formaction")?a.submitter.formAction:v(e).action),s=a.submitter?.hasAttribute("formenctype")?a.submitter.formEnctype:v(e).enctype,i=new FormData(e),_=a.submitter?.getAttribute("name");_&&i.append(_,a.submitter?.getAttribute("value")??"");const p=new AbortController;let y=!1;const M=await t({action:r,cancel:()=>y=!0,controller:p,formData:i,formElement:e,submitter:a.submitter})??o;if(y)return;let u;try{const l=new Headers({accept:"application/json","x-sveltekit-action":"true"});s!=="multipart/form-data"&&l.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(s)?s:"application/x-www-form-urlencoded");const x=s==="multipart/form-data"?i:new URLSearchParams(i),w=await fetch(r,{method:"POST",headers:l,cache:"no-store",body:x,signal:p.signal});u=V(await w.text()),u.type==="error"&&(u.status=w.status)}catch(l){if(l?.name==="AbortError")return;u={type:"error",error:l}}await M({action:r,formData:i,formElement:e,update:l=>o({action:r,result:u,reset:l?.reset,invalidateAll:l?.invalidateAll}),result:u})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",c),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",c)}}}export{K as a,W as b,$ as c,G as e};
